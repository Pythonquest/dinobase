version: 2

models:
  - name: int_occurrences_enriched
    description: >
      Enriched occurrences joining occurrence records with collection context
      (geography, stratigraphy, environment) and taxonomic hierarchy (phylum
      through genus). This is the single wide table that downstream marts
      should build from.
    columns:
      - name: occurrence_id
        description: "Unique occurrence identifier"
        tests:
          - unique
          - not_null
      - name: collection_id
        description: "Collection this occurrence belongs to"
      - name: reference_id
        description: "Primary reference identifier"
      - name: identified_name
        description: "Identified taxonomic name as entered"
      - name: taxon_id
        description: "Accepted taxon identifier"
      - name: taxon_name
        description: "Accepted taxonomic name"
      - name: taxonomic_difference_flag
        description: "Taxonomic difference flag"
      - name: taxonomic_rank
        description: "Accepted taxonomic rank (numeric)"
      - name: phylum
        description: "Phylum from taxonomic hierarchy"
      - name: taxon_class
        description: "Class from taxonomic hierarchy"
      - name: taxon_order
        description: "Order from taxonomic hierarchy"
      - name: family
        description: "Family from taxonomic hierarchy"
      - name: genus
        description: "Genus from taxonomic hierarchy"
      - name: early_age_ma
        description: "Early age bound in Ma"
      - name: early_interval
        description: "Early geological interval name"
      - name: late_interval
        description: "Late geological interval name"
      - name: latest_age_ma
        description: "Late age bound in Ma"
      - name: interval_id
        description: "Geological interval identifier"
      - name: midpoint_age_ma
        description: "Midpoint age in Ma, calculated as (early_age_ma + latest_age_ma) / 2"
      - name: time_bin_start
        description: "Start of the 10 Ma time bin this occurrence falls into, derived from midpoint_age_ma. Joins to mart_diversity_through_time.bin_start."
      - name: first_appearance_early_ma
        description: "Early bound of the taxon's first appearance in Ma"
      - name: first_appearance_late_ma
        description: "Late bound of the taxon's first appearance in Ma"
      - name: last_appearance_early_ma
        description: "Early bound of the taxon's last appearance in Ma"
      - name: last_appearance_late_ma
        description: "Late bound of the taxon's last appearance in Ma"
      - name: longitude
        description: "Modern longitude (occurrence-level, fallback to collection)"
      - name: latitude
        description: "Modern latitude (occurrence-level, fallback to collection)"
      - name: paleo_longitude
        description: "Reconstructed paleolongitude"
      - name: paleo_latitude
        description: "Reconstructed paleolatitude"
      - name: paleo_model
        description: "Plate tectonic model used for paleocoordinate reconstruction"
      - name: geoplate_id
        description: "Geoplate identifier"
      - name: collection_name
        description: "Descriptive name of the collection"
      - name: country_code
        description: "Two-letter country code"
      - name: state_province
        description: "State or province"
      - name: county
        description: "County or equivalent subdivision"
      - name: formation
        description: "Stratigraphic formation"
      - name: strat_group
        description: "Stratigraphic group"
      - name: strat_member
        description: "Stratigraphic member"
      - name: environment
        description: "Depositional environment"
      - name: record_flags
        description: "Record-level quality/status flags"
      - name: _dbt_loaded_at
        description: "Timestamp when the record was loaded by dbt"
